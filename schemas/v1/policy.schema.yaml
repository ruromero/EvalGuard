$schema: http://json-schema.org/draft/2020-12/schema
$id: https://github.com/evalguard/evalguard/schemas/v1/policy.schema.yaml
title: Policy
description: |
  Schema for a policy used to evaluate tasks in model evaluations. 
  Policies organize thresholds and guardrails by evaluation context.
  
  Thresholds are embedded within policies, organized by task ID and metric ID.
type: object
properties:
  id:
    type: string
    description: Unique policy identifier, used to link policies to tasks and reports.
  name:
    type: string
    description: Human-readable name of the policy.
  description:
    type: string
    description: Detailed description of the policy.
  thresholds:
    type: object
    description: Thresholds for the policy, organized by task ID. Each task maps to a TaskThresholds object.
    patternProperties:
      "^[a-zA-Z0-9_-]+$":
        $ref: "#/definitions/TaskThresholds"
required:
  - id
  - name
  - description
additionalProperties: false
definitions:
  TaskThresholds:
    type: object
    description: Thresholds for a specific task. Each metric maps to an array of ThresholdRangeItem objects.
    patternProperties:
      "^[a-zA-Z0-9_-]+$":
        type: array
        description: Array of threshold ranges for a specific metric
        items:
          $ref: "#/definitions/ThresholdRangeItem"
  ThresholdRangeItem:
    type: object
    description: A threshold range with label and optional min/max values
    properties:
      impact:
        type: string
        enum: [no_measurable, very_low, low, moderate, high, severe]
        description: |
          Security impact level of the threshold.
          
          - `no_measurable`: No measurable security risk
          - `very_low`: Very low security risk
          - `low`: Minimal security risk
          - `moderate`: Moderate security risk
          - `high`: Significant security risk
          - `severe`: Critical security risk
      min:
        type: number
        description: Inclusive minimum value for this range. Optional if only max is set.
      max:
        type: number
        description: Exclusive maximum value for this range. Optional if only min is set.
      interpretation:
        type: string
        description: Optional detailed explanation of what this threshold range means.
    required:
      - impact
    additionalProperties: false
    anyOf:
      - required:
          - min
      - required:
          - max
